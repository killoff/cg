var qq=function(e){"use strict";return{hide:function(){e.style.display="none";return this},attach:function(t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){e.attachEvent("on"+t,n)}return function(){qq(e).detach(t,n)}},detach:function(t,n){if(e.removeEventListener){e.removeEventListener(t,n,false)}else if(e.attachEvent){e.detachEvent("on"+t,n)}return this},contains:function(t){if(e===t){return true}if(e.contains){return e.contains(t)}else{return!!(t.compareDocumentPosition(e)&8)}},insertBefore:function(t){t.parentNode.insertBefore(e,t);return this},remove:function(){e.parentNode.removeChild(e);return this},css:function(t){if(t.opacity!==null){if(typeof e.style.opacity!=="string"&&typeof e.filters!=="undefined"){t.filter="alpha(opacity="+Math.round(100*t.opacity)+")"}}qq.extend(e.style,t);return this},hasClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");return n.test(e.className)},addClass:function(t){if(!qq(e).hasClass(t)){e.className+=" "+t}return this},removeClass:function(t){var n=new RegExp("(^| )"+t+"( |$)");e.className=e.className.replace(n," ").replace(/^\s+|\s+$/g,"");return this},getByClass:function(t){var n,r=[];if(e.querySelectorAll){return e.querySelectorAll("."+t)}n=e.getElementsByTagName("*");qq.each(n,function(e,n){if(qq(n).hasClass(t)){r.push(n)}});return r},children:function(){var t=[],n=e.firstChild;while(n){if(n.nodeType===1){t.push(n)}n=n.nextSibling}return t},setText:function(t){e.innerText=t;e.textContent=t;return this},clearText:function(){return qq(e).setText("")}}};qq.log=function(e,t){"use strict";if(window.console){if(!t||t==="info"){window.console.log(e)}else{if(window.console[t]){window.console[t](e)}else{window.console.log("<"+t+"> "+e)}}}};qq.isObject=function(e){"use strict";return e!==null&&e&&typeof e==="object"&&e.constructor===Object};qq.isFunction=function(e){"use strict";return typeof e==="function"};qq.isString=function(e){"use strict";return Object.prototype.toString.call(e)==="[object String]"};qq.trimStr=function(e){if(String.prototype.trim){return e.trim()}return e.replace(/^\s+|\s+$/g,"")};qq.isFileOrInput=function(e){"use strict";if(qq.isBlob(e)&&window.File&&e instanceof File){return true}else if(window.HTMLInputElement){if(e instanceof HTMLInputElement){if(e.type&&e.type.toLowerCase()==="file"){return true}}}else if(e.tagName){if(e.tagName.toLowerCase()==="input"){if(e.type&&e.type.toLowerCase()==="file"){return true}}}return false};qq.isBlob=function(e){"use strict";return window.Blob&&e instanceof Blob};qq.isXhrUploadSupported=function(){"use strict";var e=document.createElement("input");e.type="file";return e.multiple!==undefined&&typeof File!=="undefined"&&typeof FormData!=="undefined"&&typeof (new XMLHttpRequest).upload!=="undefined"};qq.isFolderDropSupported=function(e){"use strict";return e.items&&e.items[0].webkitGetAsEntry};qq.isFileChunkingSupported=function(){"use strict";return!qq.android()&&qq.isXhrUploadSupported()&&(File.prototype.slice||File.prototype.webkitSlice||File.prototype.mozSlice)};qq.extend=function(e,t,n){"use strict";qq.each(t,function(t,r){if(n&&qq.isObject(r)){if(e[t]===undefined){e[t]={}}qq.extend(e[t],r,true)}else{e[t]=r}})};qq.indexOf=function(e,t,n){"use strict";if(e.indexOf){return e.indexOf(t,n)}n=n||0;var r=e.length;if(n<0){n+=r}for(;n<r;n+=1){if(e.hasOwnProperty(n)&&e[n]===t){return n}}return-1};qq.getUniqueId=function(){"use strict";return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})};qq.ie=function(){"use strict";return navigator.userAgent.indexOf("MSIE")!==-1};qq.ie10=function(){"use strict";return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.safari=function(){"use strict";return navigator.vendor!==undefined&&navigator.vendor.indexOf("Apple")!==-1};qq.chrome=function(){"use strict";return navigator.vendor!==undefined&&navigator.vendor.indexOf("Google")!==-1};qq.firefox=function(){"use strict";return navigator.userAgent.indexOf("Mozilla")!==-1&&navigator.vendor!==undefined&&navigator.vendor===""};qq.windows=function(){"use strict";return navigator.platform==="Win32"};qq.android=function(){"use strict";return navigator.userAgent.toLowerCase().indexOf("android")!==-1};qq.preventDefault=function(e){"use strict";if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}};qq.toElement=function(){"use strict";var e=document.createElement("div");return function(t){e.innerHTML=t;var n=e.firstChild;e.removeChild(n);return n}}();qq.each=function(e,t){"use strict";var n,r;if(e){for(n in e){if(Object.prototype.hasOwnProperty.call(e,n)){r=t(n,e[n]);if(r===false){break}}}}};qq.obj2url=function(e,t,n){"use strict";var r,i,s=[],o="&",u=function(e,n){var r=t?/\[\]$/.test(t)?t:t+"["+n+"]":n;if(r!=="undefined"&&n!=="undefined"){s.push(typeof e==="object"?qq.obj2url(e,r,true):Object.prototype.toString.call(e)==="[object Function]"?encodeURIComponent(r)+"="+encodeURIComponent(e()):encodeURIComponent(r)+"="+encodeURIComponent(e))}};if(!n&&t){o=/\?/.test(t)?/\?$/.test(t)?"":"&":"?";s.push(t);s.push(qq.obj2url(e))}else if(Object.prototype.toString.call(e)==="[object Array]"&&typeof e!=="undefined"){for(r=-1,i=e.length;r<i;r+=1){u(e[r],r)}}else if(typeof e!=="undefined"&&e!==null&&typeof e==="object"){for(r in e){if(e.hasOwnProperty(r)){u(e[r],r)}}}else{s.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}if(t){return s.join(o)}else{return s.join(o).replace(/^&/,"").replace(/%20/g,"+")}};qq.obj2FormData=function(e,t,n){"use strict";if(!t){t=new FormData}qq.each(e,function(e,r){e=n?n+"["+e+"]":e;if(qq.isObject(r)){qq.obj2FormData(r,t,e)}else if(qq.isFunction(r)){t.append(e,r())}else{t.append(e,r)}});return t};qq.obj2Inputs=function(e,t){"use strict";var n;if(!t){t=document.createElement("form")}qq.obj2FormData(e,{append:function(e,r){n=document.createElement("input");n.setAttribute("name",e);n.setAttribute("value",r);t.appendChild(n)}});return t};qq.setCookie=function(e,t,n){var r=new Date,i="";if(n){r.setTime(r.getTime()+n*24*60*60*1e3);i="; expires="+r.toGMTString()}document.cookie=e+"="+t+i+"; path=/"};qq.getCookie=function(e){var t=e+"=",n=document.cookie.split(";"),r;for(var i=0;i<n.length;i++){r=n[i];while(r.charAt(0)==" "){r=r.substring(1,r.length)}if(r.indexOf(t)===0){return r.substring(t.length,r.length)}}};qq.getCookieNames=function(e){var t=document.cookie.split(";"),n=[];qq.each(t,function(t,r){r=qq.trimStr(r);var i=r.indexOf("=");if(r.match(e)){n.push(r.substr(0,i))}});return n};qq.deleteCookie=function(e){qq.setCookie(e,"",-1)};qq.areCookiesEnabled=function(){var e=Math.random()*1e5,t="qqCookieTest:"+e;qq.setCookie(t,1);if(qq.getCookie(t)){qq.deleteCookie(t);return true}return false};qq.parseJson=function(json){if(window.JSON&&qq.isFunction(JSON.parse)){return JSON.parse(json)}else{return eval("("+json+")")}};qq.DisposeSupport=function(){"use strict";var e=[];return{dispose:function(){var t;do{t=e.shift();if(t){t()}}while(t)},attach:function(){var e=arguments;this.addDisposer(qq(e[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(t){e.push(t)}}};qq.Promise=function(){"use strict";var e,t,n,r,i=0;return{then:function(s,o){if(i===0){n=s;r=o}else if(i===-1&&o){o(t)}else if(s){s(e)}},success:function(t){i=1;e=t;if(n){n(t)}return this},failure:function(e){i=-1;t=e;if(r){r(e)}return this}}};qq.UploadButton=function(e){"use strict";function i(){var e=document.createElement("input");if(r.multiple){e.setAttribute("multiple","multiple")}if(r.acceptFiles){e.setAttribute("accept",r.acceptFiles)}e.setAttribute("type","file");e.setAttribute("name",r.name);qq(e).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0});r.element.appendChild(e);n.attach(e,"change",function(){r.onChange(e)});n.attach(e,"mouseover",function(){qq(r.element).addClass(r.hoverClass)});n.attach(e,"mouseout",function(){qq(r.element).removeClass(r.hoverClass)});n.attach(e,"focus",function(){qq(r.element).addClass(r.focusClass)});n.attach(e,"blur",function(){qq(r.element).removeClass(r.focusClass)});if(window.attachEvent){e.setAttribute("tabIndex","-1")}return e}var t,n=new qq.DisposeSupport,r={element:null,multiple:false,acceptFiles:null,name:"file",onChange:function(e){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(r,e);qq(r.element).css({position:"relative",overflow:"hidden",direction:"ltr"});t=i();return{getInput:function(){return t},reset:function(){if(t.parentNode){qq(t).remove()}qq(r.element).removeClass(r.focusClass);t=i()}}};qq.AjaxRequestor=function(e){"use strict";function o(e){var t=qq.indexOf(r,e),n=s.maxConnections,o;delete i[e];r.splice(t,1);if(r.length>=n&&t<n){o=r[n-1];a(o)}}function u(e){var n=i[e].xhr,r=d(),u=false;o(e);if(!p(n.status)){u=true;t(r+" request for "+e+" has failed - response code "+n.status,"error")}s.onComplete(e,n,u)}function a(e){var r=new XMLHttpRequest,o=d(),u={},a;s.onSend(e);if(s.paramsStore.getParams){u=s.paramsStore.getParams(e)}a=f(e,u);i[e].xhr=r;r.onreadystatechange=l(e);r.open(o,a,true);if(s.cors.expected&&s.cors.sendCredentials){r.withCredentials=true}c(e);t("Sending "+o+" request for "+e);if(!n&&u){r.send(qq.obj2url(u,""))}else{r.send()}}function f(e,t){var r=s.endpointStore.getEndpoint(e),o=i[e].addToPath;if(o!==undefined){r+="/"+o}if(n&&t){return qq.obj2url(t,r)}else{return r}}function l(e){var t=i[e].xhr;return function(){if(t.readyState===4){u(e,t)}}}function c(e){var t=i[e].xhr,n=s.customHeaders;t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.setRequestHeader("Cache-Control","no-cache");qq.each(n,function(e,n){t.setRequestHeader(e,n)})}function h(e){var n=i[e].xhr,r=d();if(n){n.onreadystatechange=null;n.abort();o(e);t("Cancelled "+r+" for "+e);s.onCancel(e);return true}return false}function p(e){return qq.indexOf(s.successfulResponseCodes,e)>=0}function d(){if(s.demoMode){return"GET"}return s.method}var t,n,r=[],i=[],s={method:"POST",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},successfulResponseCodes:[200],demoMode:false,cors:{expected:false,sendCredentials:false},log:function(e,t){},onSend:function(e){},onComplete:function(e,t,n){},onCancel:function(e){}};qq.extend(s,e);t=s.log;n=d()==="GET"||d()==="DELETE";return{send:function(e,t){i[e]={addToPath:t};var n=r.push(e);if(n<=s.maxConnections){a(e)}},cancel:function(e){return h(e)}}};qq.DeleteFileAjaxRequestor=function(e){"use strict";var t,n={endpointStore:{},maxConnections:3,customHeaders:{},paramsStore:{},demoMode:false,cors:{expected:false,sendCredentials:false},log:function(e,t){},onDelete:function(e){},onDeleteComplete:function(e,t,n){}};qq.extend(n,e);t=new qq.AjaxRequestor({method:"DELETE",endpointStore:n.endpointStore,paramsStore:n.paramsStore,maxConnections:n.maxConnections,customHeaders:n.customHeaders,successfulResponseCodes:[200,202,204],demoMode:n.demoMode,log:n.log,onSend:n.onDelete,onComplete:n.onDeleteComplete});return{sendDelete:function(e,r){t.send(e,r);n.log("Submitted delete file request for "+e)}}};qq.UploadHandler=function(e){"use strict";var t=[],n,r,i,s;n={debug:false,forceMultipart:true,paramsInBody:false,paramsStore:{},endpointStore:{},cors:{expected:false,sendCredentials:false},maxConnections:3,uuidParamName:"qquuid",totalFileSizeParamName:"qqtotalfilesize",chunking:{enabled:false,partSize:2e6,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},blobs:{paramNames:{name:"qqblobname"}},log:function(e,t){},onProgress:function(e,t,n,r){},onComplete:function(e,t,n,r){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onAutoRetry:function(e,t,n,r){},onResume:function(e,t,n){}};qq.extend(n,e);r=n.log;i=function(e){var r=qq.indexOf(t,e),i=n.maxConnections,o;if(r>=0){t.splice(r,1);if(t.length>=i&&r<i){o=t[i-1];s.upload(o)}}};if(qq.isXhrUploadSupported()){s=new qq.UploadHandlerXhr(n,i,r)}else{s=new qq.UploadHandlerForm(n,i,r)}return{add:function(e){return s.add(e)},upload:function(e){var r=t.push(e);if(r<=n.maxConnections){return s.upload(e)}},retry:function(e){var n=qq.indexOf(t,e);if(n>=0){return s.upload(e,true)}else{return this.upload(e)}},cancel:function(e){r("Cancelling "+e);n.paramsStore.remove(e);s.cancel(e);i(e)},cancelAll:function(){var e=this,n=[];qq.extend(n,t);qq.each(n,function(t,n){e.cancel(n)});t=[]},getName:function(e){return s.getName(e)},getSize:function(e){if(s.getSize){return s.getSize(e)}},getFile:function(e){if(s.getFile){return s.getFile(e)}},getQueue:function(){return t},reset:function(){r("Resetting upload handler");t=[];s.reset()},getUuid:function(e){return s.getUuid(e)},isValid:function(e){return s.isValid(e)},getResumableFilesData:function(){if(s.getResumableFilesData){return s.getResumableFilesData()}return[]}}};qq.WindowReceiveMessage=function(e){var t={log:function(e,t){}},n={};qq.extend(t,e);return{receiveMessage:function(e,t){var r=function(e){t(e.data)};if(window.postMessage){n[e]=qq(window).attach("message",r)}else{log("iframe message passing not supported in this browser!","error")}},stopReceivingMessages:function(e){if(window.postMessage){var t=n[e];if(t){t()}}}}};qq.UploadHandlerForm=function(e,t,n){"use strict";function p(e){if(o[e]!==undefined){o[e]();delete o[e]}}function d(e,t){var n=e.id;c[s[n]]=t;o[n]=qq(e).attach("load",function(){if(i[n]){f("Received iframe load event for CORS upload request (file id "+n+")");u[n]=setTimeout(function(){var e="No valid message received from loaded iframe for file id "+n;f(e,"error");t({error:e})},1e3)}});l.receiveMessage(n,function(e){f("Received the following window message: '"+e+"'");var t=qq.parseJson(e),r=t.uuid,i;if(r&&c[r]){clearTimeout(u[n]);delete u[n];p(n);i=c[r];delete c[r];l.stopReceivingMessages(n);i(t)}else if(!r){f("'"+e+"' does not contain a UUID - ignoring.")}})}function v(e,t){if(r.cors.expected){d(e,t)}else{o[e.id]=qq(e).attach("load",function(){f("Received response for "+e.id);if(!e.parentNode){return}try{if(e.contentDocument&&e.contentDocument.body&&e.contentDocument.body.innerHTML=="false"){return}}catch(n){f("Error when attempting to access iframe during handling of upload response ("+n+")","error")}t()})}}function m(e){var t;try{var n=e.contentDocument||e.contentWindow.document,r=n.body.innerHTML;f("converting iframe's innerHTML to JSON");f("innerHTML = "+r);if(r&&r.match(/^<pre/i)){r=n.body.firstChild.firstChild.nodeValue}t=qq.parseJson(r)}catch(i){f("Error when attempting to parse form upload response ("+i+")","error");t={success:false}}return t}function g(e){var t=qq.toElement('<iframe src="javascript:false;" name="'+e+'" />');t.setAttribute("id",e);t.style.display="none";document.body.appendChild(t);return t}function y(e,t){var n=r.paramsStore.getParams(e),i=r.demoMode?"GET":"POST",o=qq.toElement('<form method="'+i+'" enctype="multipart/form-data"></form>'),u=r.endpointStore.getEndpoint(e),a=u;n[r.uuidParamName]=s[e];if(!r.paramsInBody){a=qq.obj2url(n,u)}else{qq.obj2Inputs(n,o)}o.setAttribute("action",a);o.setAttribute("target",t.name);o.style.display="none";document.body.appendChild(o);return o}var r=e,i=[],s=[],o={},u={},a=t,f=n,l=new qq.WindowReceiveMessage({log:f}),c={},h;h={add:function(e){e.setAttribute("name",r.inputName);var t=i.push(e)-1;s[t]=qq.getUniqueId();if(e.parentNode){qq(e).remove()}return t},getName:function(e){return i[e].value.replace(/.*(\/|\\)/,"")},isValid:function(e){return i[e]!==undefined},reset:function(){qq.UploadHandler.prototype.reset.apply(this,arguments);i=[];s=[];o={}},getUuid:function(e){return s[e]},cancel:function(e){r.onCancel(e,this.getName(e));delete i[e];delete s[e];delete o[e];if(r.cors.expected){clearTimeout(u[e]);delete u[e];l.stopReceivingMessages(e)}var t=document.getElementById(e);if(t){t.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;");qq(t).remove()}},upload:function(e){var t=i[e],n=h.getName(e),s=g(e),o;if(!t){throw new Error("file with passed id was not added, or already uploaded or cancelled")}r.onUpload(e,this.getName(e));o=y(e,s);o.appendChild(t);v(s,function(t){f("iframe loaded");var i=t?t:m(s);p(e);if(!r.cors.expected){qq(s).remove()}if(!i.success){if(r.onAutoRetry(e,n,i)){return}}r.onComplete(e,n,i);a(e)});f("Sending upload request for "+e);o.submit();qq(o).remove();return e}};return h};qq.UploadHandlerXhr=function(e,t,n){"use strict";function p(e,t,n){var i=h.getSize(e),s=h.getName(e);t[r.chunking.paramNames.partIndex]=n.part;t[r.chunking.paramNames.partByteOffset]=n.start;t[r.chunking.paramNames.chunkSize]=n.size;t[r.chunking.paramNames.totalParts]=n.count;t[r.totalFileSizeParamName]=i;if(c){t[r.chunking.paramNames.filename]=s}}function d(e){e[r.resume.paramNames.resuming]=true}function v(e,t,n){if(e.slice){return e.slice(t,n)}else if(e.mozSlice){return e.mozSlice(t,n)}else if(e.webkitSlice){return e.webkitSlice(t,n)}}function m(e,t){var n=r.chunking.partSize,i=h.getSize(e),s=o[e].file||o[e].blobData.blob,u=n*t,a=u+n>=i?i:u+n,f=g(e);return{part:t,start:u,end:a,count:f,blob:v(s,u,a),size:a-u}}function g(e){var t=h.getSize(e),n=r.chunking.partSize;return Math.ceil(t/n)}function y(e){var t=new XMLHttpRequest;o[e].xhr=t;return t}function b(e,t,n,i){var s=new FormData,u=r.demoMode?"GET":"POST",a=r.endpointStore.getEndpoint(i),f=a,l=h.getName(i),p=h.getSize(i),d=o[i].blobData;e[r.uuidParamName]=o[i].uuid;if(c){e[r.totalFileSizeParamName]=p;if(d){e[r.blobs.paramNames.name]=d.name}}if(!r.paramsInBody){if(!c){e[r.inputName]=l}f=qq.obj2url(e,a)}t.open(u,f,true);if(r.cors.expected&&r.cors.sendCredentials){t.withCredentials=true}if(c){if(r.paramsInBody){qq.obj2FormData(e,s)}s.append(r.inputName,n);return s}return n}function w(e,t){var n=r.customHeaders,i=o[e].file||o[e].blobData.blob;t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.setRequestHeader("Cache-Control","no-cache");if(!c){t.setRequestHeader("Content-Type","application/octet-stream");t.setRequestHeader("X-Mime-Type",i.type)}qq.each(n,function(e,n){t.setRequestHeader(e,n)})}function E(e,t,n){var s=h.getName(e),u=h.getSize(e);o[e].attemptingResume=false;r.onProgress(e,s,u,u);r.onComplete(e,s,t,n);delete o[e].xhr;i(e)}function S(e){var t=o[e].remainingChunkIdxs[0],n=m(e,t),i=y(e),u=h.getSize(e),a=h.getName(e),l,c;if(o[e].loaded===undefined){o[e].loaded=0}if(f&&o[e].file){P(e,n)}i.onreadystatechange=D(e,i);i.upload.onprogress=function(n){if(n.lengthComputable){var i=n.loaded+o[e].loaded,s=x(e,t,n.total);r.onProgress(e,a,i,s)}};r.onUploadChunk(e,a,_(n));c=r.paramsStore.getParams(e);p(e,c,n);if(o[e].attemptingResume){d(c)}l=b(c,i,n.blob,e);w(e,i);s("Sending chunked upload request for item "+e+": bytes "+(n.start+1)+"-"+n.end+" of "+u);i.send(l)}function x(e,t,n){var r=m(e,t),i=r.size,s=n-i,u=h.getSize(e),a=r.count,f=o[e].initialRequestOverhead,l=s-f;o[e].lastRequestOverhead=s;if(t===0){o[e].lastChunkIdxProgress=0;o[e].initialRequestOverhead=s;o[e].estTotalRequestsSize=u+a*s}else if(o[e].lastChunkIdxProgress!==t){o[e].lastChunkIdxProgress=t;o[e].estTotalRequestsSize+=l}return o[e].estTotalRequestsSize}function T(e){if(c){return o[e].lastRequestOverhead}else{return 0}}function N(e,t,n){var r=o[e].remainingChunkIdxs.shift(),i=m(e,r);o[e].attemptingResume=false;o[e].loaded+=i.size+T(e);if(o[e].remainingChunkIdxs.length>0){S(e)}else{if(f){H(e)}E(e,t,n)}}function C(e,t){return e.status!==200||!t.success||t.reset}function k(e){var t;try{t=qq.parseJson(e.responseText)}catch(n){s("Error when attempting to parse xhr response text ("+n+")","error");t={}}return t}function L(e){s("Server has ordered chunking effort to be restarted on next attempt for item ID "+e,"error");if(f){H(e);o[e].attemptingResume=false}o[e].remainingChunkIdxs=[];delete o[e].loaded;delete o[e].estTotalRequestsSize;delete o[e].initialRequestOverhead}function A(e){o[e].attemptingResume=false;s("Server has declared that it cannot handle resume for item ID "+e+" - starting from the first chunk","error");L(e);h.upload(e,true)}function O(e,t,n){var i=h.getName(e);if(r.onAutoRetry(e,i,t,n)){return}else{E(e,t,n)}}function M(e,t){var n;if(!o[e]){return}s("xhr - server response received for "+e);s("responseText = "+t.responseText);n=k(t);if(C(t,n)){if(n.reset){L(e)}if(o[e].attemptingResume&&n.reset){A(e)}else{O(e,n,t)}}else if(a){N(e,n,t)}else{E(e,n,t)}}function _(e){return{partIndex:e.part,startByte:e.start+1,endByte:e.end,totalParts:e.count}}function D(e,t){return function(){if(t.readyState===4){M(e,t)}}}function P(e,t){var n=h.getUuid(e),i=o[e].loaded,s=o[e].initialRequestOverhead,a=o[e].estTotalRequestsSize,f=j(e),l=n+u+t.part+u+i+u+s+u+a,c=r.resume.cookiesExpireIn;qq.setCookie(f,l,c)}function H(e){if(o[e].file){var t=j(e);qq.deleteCookie(t)}}function B(e){var t=qq.getCookie(j(e)),n=h.getName(e),r,i,o,a,f,l;if(t){r=t.split(u);if(r.length===5){i=r[0];o=parseInt(r[1],10);a=parseInt(r[2],10);f=parseInt(r[3],10);l=parseInt(r[4],10);return{uuid:i,part:o,lastByteSent:a,initialRequestOverhead:f,estTotalRequestsSize:l}}else{s("Ignoring previously stored resume/chunk cookie for "+n+" - old cookie format","warn")}}}function j(e){var t=h.getName(e),n=h.getSize(e),i=r.chunking.partSize,s;s="qqfilechunk"+u+encodeURIComponent(t)+u+n+u+i;if(l!==undefined){s+=u+l}return s}function F(){if(r.resume.id!==null&&r.resume.id!==undefined&&!qq.isFunction(r.resume.id)&&!qq.isObject(r.resume.id)){return r.resume.id}}function I(e,t){var n=h.getName(e),i=0,u,a,l;if(!o[e].remainingChunkIdxs||o[e].remainingChunkIdxs.length===0){o[e].remainingChunkIdxs=[];if(f&&!t&&o[e].file){u=B(e);if(u){a=m(e,u.part);if(r.onResume(e,n,_(a))!==false){i=u.part;o[e].uuid=u.uuid;o[e].loaded=u.lastByteSent;o[e].estTotalRequestsSize=u.estTotalRequestsSize;o[e].initialRequestOverhead=u.initialRequestOverhead;o[e].attemptingResume=true;s("Resuming "+n+" at partition index "+i)}}}for(l=g(e)-1;l>=i;l-=1){o[e].remainingChunkIdxs.unshift(l)}}S(e)}function q(e){var t=o[e].file||o[e].blobData.blob,n=h.getName(e),i,u,a;o[e].loaded=0;i=y(e);i.upload.onprogress=function(t){if(t.lengthComputable){o[e].loaded=t.loaded;r.onProgress(e,n,t.loaded,t.total)}};i.onreadystatechange=D(e,i);u=r.paramsStore.getParams(e);a=b(u,i,t,e);w(e,i);s("Sending upload request for "+e);i.send(a)}var r=e,i=t,s=n,o=[],u="|",a=r.chunking.enabled&&qq.isFileChunkingSupported(),f=r.resume.enabled&&a&&qq.areCookiesEnabled(),l=F(),c=r.forceMultipart||r.paramsInBody,h;h={add:function(e){var t;if(e instanceof File){t=o.push({file:e})-1}else if(e.blob instanceof Blob){t=o.push({blobData:e})-1}else{throw new Error("Passed obj in not a File or BlobData (in qq.UploadHandlerXhr)")}o[t].uuid=qq.getUniqueId();return t},getName:function(e){var t=o[e].file,n=o[e].blobData;if(t){return t.fileName!==null&&t.fileName!==undefined?t.fileName:t.name}else{return n.name}},getSize:function(e){var t=o[e].file||o[e].blobData.blob;if(qq.isFileOrInput(t)){return t.fileSize!=null?t.fileSize:t.size}else{return t.size}},getFile:function(e){if(o[e]){return o[e].file||o[e].blobData.blob}},getLoaded:function(e){return o[e].loaded||0},isValid:function(e){return o[e]!==undefined},reset:function(){o=[]},getUuid:function(e){return o[e].uuid},upload:function(e,t){var n=this.getName(e);r.onUpload(e,n);if(a){I(e,t)}else{q(e)}},cancel:function(e){var t=o[e].xhr;r.onCancel(e,this.getName(e));if(t){t.onreadystatechange=null;t.abort()}if(f){H(e)}delete o[e]},getResumableFilesData:function(){var e=[],t=[];if(a&&f){if(l===undefined){e=qq.getCookieNames(new RegExp("^qqfilechunk\\"+u+".+\\"+u+"\\d+\\"+u+r.chunking.partSize+"="))}else{e=qq.getCookieNames(new RegExp("^qqfilechunk\\"+u+".+\\"+u+"\\d+\\"+u+r.chunking.partSize+"\\"+u+l+"="))}qq.each(e,function(e,n){var r=n.split(u);var i=qq.getCookie(n).split(u);t.push({name:decodeURIComponent(r[1]),size:r[2],uuid:i[0],partIdx:i[1]})});return t}return[]}};return h};qq.PasteSupport=function(e){"use strict";function r(e){return e.type&&e.type.indexOf("image/")===0}function i(){qq(t.targetElement).attach("paste",function(e){var n=e.clipboardData;if(n){qq.each(n.items,function(e,n){if(r(n)){var i=n.getAsFile();t.callbacks.pasteReceived(i)}})}})}function s(){if(n){n()}}var t,n;t={targetElement:null,callbacks:{log:function(e,t){},pasteReceived:function(e){}}};qq.extend(t,e);i();return{reset:function(){s()}}};qq.FineUploaderBasic=function(e){var t=this;this._options={debug:false,button:null,multiple:true,maxConnections:3,disableCancelForFormUploads:false,autoUpload:true,request:{endpoint:"/server/upload",params:{},paramsInBody:true,customHeaders:{},forceMultipart:true,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:true},callbacks:{onSubmit:function(e,t){},onSubmitted:function(e,t){},onComplete:function(e,t,n){},onCancel:function(e,t){},onUpload:function(e,t){},onUploadChunk:function(e,t,n){},onResume:function(e,t,n){},onProgress:function(e,t,n,r){},onError:function(e,t,n,r){},onAutoRetry:function(e,t,n){},onManualRetry:function(e,t){},onValidateBatch:function(e){},onValidate:function(e){},onSubmitDelete:function(e){},onDelete:function(e){},onDeleteComplete:function(e,t,n){},onPasteReceived:function(e){return(new qq.Promise).success()}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},retry:{enableAuto:false,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:false,partSize:2e6,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:false,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(e){if(e.length>33){e=e.slice(0,19)+"..."+e.slice(-14)}return e},text:{sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:false,endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:false,sendCredentials:false},blobs:{defaultName:"misc_data",paramNames:{name:"qqblobname"}},paste:{targetElement:null,defaultName:"pasted_image"}};qq.extend(this._options,e,true);this._wrapCallbacks();this._disposeSupport=new qq.DisposeSupport;this._filesInProgress=[];this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._netFilesUploadedOrQueued=0;this._paramsStore=this._createParamsStore("request");this._deleteFileParamsStore=this._createParamsStore("deleteFile");this._endpointStore=this._createEndpointStore("request");this._deleteFileEndpointStore=this._createEndpointStore("deleteFile");this._handler=this._createUploadHandler();this._deleteHandler=this._createDeleteHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}if(this._options.paste.targetElement){this._pasteHandler=this._createPasteHandler()}this._preventLeaveInProgress()};qq.FineUploaderBasic.prototype={log:function(e,t){if(this._options.debug&&(!t||t==="info")){qq.log("[FineUploader] "+e)}else if(t&&t!=="info"){qq.log("[FineUploader] "+e,t)}},setParams:function(e,t){if(t==null){this._options.request.params=e}else{this._paramsStore.setParams(e,t)}},setDeleteFileParams:function(e,t){if(t==null){this._options.deleteFile.params=e}else{this._deleteFileParamsStore.setParams(e,t)}},setEndpoint:function(e,t){if(t==null){this._options.request.endpoint=e}else{this._endpointStore.setEndpoint(e,t)}},getInProgress:function(){return this._filesInProgress.length},uploadStoredFiles:function(){"use strict";var e;while(this._storedIds.length){e=this._storedIds.shift();this._filesInProgress.push(e);this._handler.upload(e)}},clearStoredFiles:function(){this._storedIds=[]},retry:function(e){if(this._onBeforeManualRetry(e)){this._netFilesUploadedOrQueued++;this._handler.retry(e);return true}else{return false}},cancel:function(e){this._handler.cancel(e)},cancelAll:function(){var e=[],t=this;qq.extend(e,this._storedIds);qq.each(e,function(e,n){t.cancel(n)});this._handler.cancelAll()},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._filesInProgress=[];this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._button.reset();this._paramsStore.reset();this._endpointStore.reset();this._pasteHandler.reset();this._netFilesUploadedOrQueued=0},addFiles:function(e){var t=this,n=[],r,i;if(e){if(!window.FileList||!(e instanceof FileList)){e=[].concat(e)}for(r=0;r<e.length;r+=1){i=e[r];if(qq.isFileOrInput(i)){n.push(i)}else{t.log(i+" is not a File or INPUT element!  Ignoring!","warn")}}this.log("Processing "+n.length+" files or inputs...");this._uploadFileOrBlobDataList(n)}},addBlobs:function(e){if(e){var t=[].concat(e),n=[],r=this;qq.each(t,function(e,t){if(qq.isBlob(t)&&!qq.isFileOrInput(t)){n.push({blob:t,name:r._options.blobs.defaultName})}else if(qq.isObject(t)&&t.blob&&t.name){n.push(t)}else{r.log("addBlobs: entry at index "+e+" is not a Blob or a BlobData object","error")}});this._uploadFileOrBlobDataList(n)}else{this.log("undefined or non-array parameter passed into addBlobs","error")}},getUuid:function(e){return this._handler.getUuid(e)},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(e){return this._handler.getSize(e)},getName:function(e){return this._handler.getName(e)},getFile:function(e){return this._handler.getFile(e)},deleteFile:function(e){this._onSubmitDelete(e)},setDeleteFileEndpoint:function(e,t){if(t==null){this._options.deleteFile.endpoint=e}else{this._deleteFileEndpointStore.setEndpoint(e,t)}},getPromissoryCallbackNames:function(){return["onPasteReceived"]},_createUploadButton:function(e){var t=this;var n=new qq.UploadButton({element:e,multiple:this._options.multiple&&qq.isXhrUploadSupported(),acceptFiles:this._options.validation.acceptFiles,onChange:function(e){t._onInputChange(e)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});this._disposeSupport.addDisposer(function(){n.dispose()});return n},_createUploadHandler:function(){var e=this;return new qq.UploadHandler({debug:this._options.debug,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,uuidParamName:this._options.request.uuidName,totalFileSizeParamName:this._options.request.totalFileSizeName,cors:this._options.cors,demoMode:this._options.demoMode,paramsInBody:this._options.request.paramsInBody,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:function(t,n){e.log(t,n)},onProgress:function(t,n,r,i){e._onProgress(t,n,r,i);e._options.callbacks.onProgress(t,n,r,i)},onComplete:function(t,n,r,i){e._onComplete(t,n,r,i);e._options.callbacks.onComplete(t,n,r)},onCancel:function(t,n){e._onCancel(t,n);e._options.callbacks.onCancel(t,n)},onUpload:function(t,n){e._onUpload(t,n);e._options.callbacks.onUpload(t,n)},onUploadChunk:function(t,n,r){e._options.callbacks.onUploadChunk(t,n,r)},onResume:function(t,n,r){return e._options.callbacks.onResume(t,n,r)},onAutoRetry:function(t,n,r,i){e._preventRetries[t]=r[e._options.retry.preventRetryResponseProperty];if(e._shouldAutoRetry(t,n,r)){e._maybeParseAndSendUploadError(t,n,r,i);e._options.callbacks.onAutoRetry(t,n,e._autoRetries[t]+1);e._onBeforeAutoRetry(t,n);e._retryTimeouts[t]=setTimeout(function(){e._onAutoRetry(t,n,r)},e._options.retry.autoAttemptDelay*1e3);return true}else{return false}}})},_createDeleteHandler:function(){var e=this;return new qq.DeleteFileAjaxRequestor({maxConnections:this._options.maxConnections,customHeaders:this._options.deleteFile.customHeaders,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:function(t,n){e.log(t,n)},onDelete:function(t){e._onDelete(t);e._options.callbacks.onDelete(t)},onDeleteComplete:function(t,n,r){e._onDeleteComplete(t,n,r);e._options.callbacks.onDeleteComplete(t,n,r)}})},_createPasteHandler:function(){var e=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:function(t,n){e.log(t,n)},pasteReceived:function(t){var n=e._options.callbacks.onPasteReceived,r=n(t);if(r.then){r.then(function(n){e._handlePasteSuccess(t,n)},function(t){e.log("Ignoring pasted image per paste received callback.  Reason = '"+t+"'")})}else{e.log("Promise contract not fulfilled in pasteReceived callback handler!  Ignoring pasted item.","error")}}}})},_handlePasteSuccess:function(e,t){var n=e.type.split("/")[1],r=t;if(r==null){r=this._options.paste.defaultName}r+="."+n;this.addBlobs({name:r,blob:e})},_preventLeaveInProgress:function(){var e=this;this._disposeSupport.attach(window,"beforeunload",function(t){if(!e._filesInProgress.length){return}var t=t||window.event;t.returnValue=e._options.messages.onLeave;return e._options.messages.onLeave})},_onSubmit:function(e,t){this._netFilesUploadedOrQueued++;if(this._options.autoUpload){this._filesInProgress.push(e)}},_onProgress:function(e,t,n,r){},_onComplete:function(e,t,n,r){if(!n.success){this._netFilesUploadedOrQueued--}this._removeFromFilesInProgress(e);this._maybeParseAndSendUploadError(e,t,n,r)},_onCancel:function(e,t){this._netFilesUploadedOrQueued--;this._removeFromFilesInProgress(e);clearTimeout(this._retryTimeouts[e]);var n=qq.indexOf(this._storedIds,e);if(!this._options.autoUpload&&n>=0){this._storedIds.splice(n,1)}},_isDeletePossible:function(){return this._options.deleteFile.enabled&&(!this._options.cors.expected||this._options.cors.expected&&(qq.ie10()||!qq.ie()))},_onSubmitDelete:function(e){if(this._isDeletePossible()){if(this._options.callbacks.onSubmitDelete(e)!==false){this._deleteHandler.sendDelete(e,this.getUuid(e))}}else{this.log("Delete request ignored for ID "+e+", delete feature is disabled or request not possible "+"due to CORS on a user agent that does not support pre-flighting.","warn");return false}},_onDelete:function(e){},_onDeleteComplete:function(e,t,n){var r=this._handler.getName(e);if(n){this.log("Delete request for '"+r+"' has failed.","error");this._options.callbacks.onError(e,r,"Delete request failed with response code "+t.status,t)}else{this._netFilesUploadedOrQueued--;this.log("Delete request for '"+r+"' has succeeded.")}},_removeFromFilesInProgress:function(e){var t=qq.indexOf(this._filesInProgress,e);if(t>=0){this._filesInProgress.splice(t,1)}},_onUpload:function(e,t){},_onInputChange:function(e){if(qq.isXhrUploadSupported()){this.addFiles(e.files)}else{this.addFiles(e)}this._button.reset()},_onBeforeAutoRetry:function(e,t){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+t+"...")},_onAutoRetry:function(e,t,n){this.log("Retrying "+t+"...");this._autoRetries[e]++;this._handler.retry(e)},_shouldAutoRetry:function(e,t,n){if(!this._preventRetries[e]&&this._options.retry.enableAuto){if(this._autoRetries[e]===undefined){this._autoRetries[e]=0}return this._autoRetries[e]<this._options.retry.maxAutoAttempts}return false},_onBeforeManualRetry:function(e){var t=this._options.validation.itemLimit;if(this._preventRetries[e]){this.log("Retries are forbidden for id "+e,"warn");return false}else if(this._handler.isValid(e)){var n=this._handler.getName(e);if(this._options.callbacks.onManualRetry(e,n)===false){return false}if(t>0&&this._netFilesUploadedOrQueued+1>t){this._itemError("retryFailTooManyItems","");return false}this.log("Retrying upload for '"+n+"' (id: "+e+")...");this._filesInProgress.push(e);return true}else{this.log("'"+e+"' is not a valid file ID","error");return false}},_maybeParseAndSendUploadError:function(e,t,n,r){if(!n.success){if(r&&r.status!==200&&!n.error){this._options.callbacks.onError(e,t,"XHR returned response code "+r.status,r)}else{var i=n.error?n.error:"Upload failure reason unknown";this._options.callbacks.onError(e,t,i,r)}}},_uploadFileOrBlobDataList:function(e){var t,n=this._getValidationDescriptors(e),r=this._isBatchValid(n);if(r){if(e.length>0){for(t=0;t<e.length;t++){if(this._validateFileOrBlobData(e[t])){this._upload(e[t])}else{if(this._options.validation.stopOnFirstInvalidFile){return}}}}else{this._itemError("noFilesError","")}}},_upload:function(e){var t=this._handler.add(e);var n=this._handler.getName(t);if(this._options.callbacks.onSubmit(t,n)!==false){this._onSubmit(t,n);this._options.callbacks.onSubmitted(t,n);if(this._options.autoUpload){this._handler.upload(t)}else{this._storeForLater(t)}}},_storeForLater:function(e){this._storedIds.push(e)},_isBatchValid:function(e){var t,n=this._options.validation.itemLimit,r=this._netFilesUploadedOrQueued+e.length,i=this._options.callbacks.onValidateBatch(e)!==false;if(i){if(n===0||r<=n){i=true}else{i=false;t=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,r).replace(/\{itemLimit\}/g,n);this._batchError(t)}}return i},_validateFileOrBlobData:function(e){var t,n,r;t=this._getValidationDescriptor(e);n=t.name;r=t.size;if(this._options.callbacks.onValidate(t)===false){return false}if(qq.isFileOrInput(e)&&!this._isAllowedExtension(n)){this._itemError("typeError",n);return false}else if(r===0){this._itemError("emptyError",n);return false}else if(r&&this._options.validation.sizeLimit&&r>this._options.validation.sizeLimit){this._itemError("sizeError",n);return false}else if(r&&r<this._options.validation.minSizeLimit){this._itemError("minSizeError",n);return false}return true},_itemError:function(e,t){function s(e,t){n=n.replace(e,t)}var n=this._options.messages[e],r=[],i;qq.each(this._options.validation.allowedExtensions,function(e,t){if(qq.isString(t)){r.push(t)}});i=r.join(", ").toLowerCase();s("{file}",this._options.formatFileName(t));s("{extensions}",i);s("{sizeLimit}",this._formatSize(this._options.validation.sizeLimit));s("{minSizeLimit}",this._formatSize(this._options.validation.minSizeLimit));this._options.callbacks.onError(null,t,n);return n},_batchError:function(e){this._options.callbacks.onError(null,null,e)},_isAllowedExtension:function(e){var t=this._options.validation.allowedExtensions,n=false;if(!t.length){return true}qq.each(t,function(t,r){if(qq.isString(r)){var i=new RegExp("\\."+r+"$","i");if(e.match(i)!=null){n=true;return false}}});return n},_formatSize:function(e){var t=-1;do{e=e/1024;t++}while(e>99);return Math.max(e,.1).toFixed(1)+this._options.text.sizeSymbols[t]},_wrapCallbacks:function(){var e,t;e=this;t=function(t,n,r){try{return n.apply(e,r)}catch(i){e.log("Caught exception in '"+t+"' callback - "+i.message,"error")}};for(var n in this._options.callbacks){(function(){var r,i;r=n;i=e._options.callbacks[r];e._options.callbacks[r]=function(){return t(r,i,arguments)}})()}},_parseFileOrBlobDataName:function(e){var t;if(qq.isFileOrInput(e)){if(e.value){t=e.value.replace(/.*(\/|\\)/,"")}else{t=e.fileName!==null&&e.fileName!==undefined?e.fileName:e.name}}else{t=e.name}return t},_parseFileOrBlobDataSize:function(e){var t;if(qq.isFileOrInput(e)){if(!e.value){t=e.fileSize!==null&&e.fileSize!==undefined?e.fileSize:e.size}}else{t=e.blob.size}return t},_getValidationDescriptor:function(e){var t,n,r;r={};t=this._parseFileOrBlobDataName(e);n=this._parseFileOrBlobDataSize(e);r.name=t;if(n){r.size=n}return r},_getValidationDescriptors:function(e){var t=this,n=[];qq.each(e,function(e,r){n.push(t._getValidationDescriptor(r))});return n},_createParamsStore:function(e){var t={},n=this;return{setParams:function(e,n){var r={};qq.extend(r,e);t[n]=r},getParams:function(r){var i={};if(r!=null&&t[r]){qq.extend(i,t[r])}else{qq.extend(i,n._options[e].params)}return i},remove:function(e){return delete t[e]},reset:function(){t={}}}},_createEndpointStore:function(e){var t={},n=this;return{setEndpoint:function(e,n){t[n]=e},getEndpoint:function(r){if(r!=null&&t[r]){return t[r]}return n._options[e].endpoint},remove:function(e){return delete t[e]},reset:function(){t={}}}}};qq.DragAndDrop=function(e){"use strict";function a(){if(s===o&&!r){t.callbacks.log("Grabbed "+i.length+" files after tree traversal.");n.dropDisabled(false);t.callbacks.dropProcessing(false,i)}}function f(e){i.push(e);o+=1;a()}function l(e){var t,n;s+=1;if(e.isFile){e.file(function(e){f(e)})}else if(e.isDirectory){r=true;t=e.createReader();t.readEntries(function(e){o+=1;for(n=0;n<e.length;n+=1){l(e[n])}r=false;if(!e.length){a()}})}}function c(e){var r,u,f;t.callbacks.dropProcessing(true);n.dropDisabled(true);if(e.files.length>1&&!t.multiple){t.callbacks.dropProcessing(false);t.callbacks.error("tooManyFilesError","");n.dropDisabled(false)}else{i=[];s=0;o=0;if(qq.isFolderDropSupported(e)){u=e.items;for(r=0;r<u.length;r+=1){f=u[r].webkitGetAsEntry();if(f){if(f.isFile){i.push(u[r].getAsFile());if(r===u.length-1){a()}}else{l(f)}}}}else{t.callbacks.dropProcessing(false,e.files);n.dropDisabled(false)}}}function h(e){n=new qq.UploadDropZone({element:e,onEnter:function(n){qq(e).addClass(t.classes.dropActive);n.stopPropagation()},onLeaveNotDescendants:function(n){qq(e).removeClass(t.classes.dropActive)},onDrop:function(n){if(t.hideDropzones){qq(e).hide()}qq(e).removeClass(t.classes.dropActive);c(n.dataTransfer)}});u.addDisposer(function(){n.dispose()});if(t.hideDropzones){qq(e).hide()}}function p(e){var t;qq.each(e.dataTransfer.types,function(e,n){if(n==="Files"){t=true;return false}});return t}function d(){if(t.dropArea){t.extraDropzones.push(t.dropArea)}var e,r=t.extraDropzones;for(e=0;e<r.length;e+=1){h(r[e])}if(t.dropArea&&(!qq.ie()||qq.ie10())){u.attach(document,"dragenter",function(i){if(!n.dropDisabled()&&p(i)){if(qq(t.dropArea).hasClass(t.classes.dropDisabled)){return}t.dropArea.style.display="block";for(e=0;e<r.length;e+=1){r[e].style.display="block"}}})}u.attach(document,"dragleave",function(n){if(t.hideDropzones&&qq.FineUploader.prototype._leaving_document_out(n)){for(e=0;e<r.length;e+=1){qq(r[e]).hide()}}});u.attach(document,"drop",function(n){if(t.hideDropzones){for(e=0;e<r.length;e+=1){qq(r[e]).hide()}}n.preventDefault()})}var t,n,r,i=[],s=0,o=0,u=new qq.DisposeSupport;t={dropArea:null,extraDropzones:[],hideDropzones:true,multiple:true,classes:{dropActive:null},callbacks:{dropProcessing:function(e,t){},error:function(e,t){},log:function(e,t){}}};qq.extend(t,e);return{setup:function(){d()},setupExtraDropzone:function(e){t.extraDropzones.push(e);h(e)},removeExtraDropzone:function(e){var n,r=t.extraDropzones;for(n in r){if(r[n]===e){return r.splice(n,1)}}},dispose:function(){u.dispose();n.dispose()}}};qq.UploadDropZone=function(e){"use strict";function o(){return qq.safari()||qq.firefox()&&qq.windows()}function u(e){if(!i){if(o){s.attach(document,"dragover",function(e){e.preventDefault()})}else{s.attach(document,"dragover",function(e){if(e.dataTransfer){e.dataTransfer.dropEffect="none";e.preventDefault()}})}i=true}}function a(e){if(qq.ie()&&!qq.ie10()){return false}var t,n=e.dataTransfer,r=qq.safari();t=qq.ie10()?true:n.effectAllowed!=="none";return n&&t&&(n.files||!r&&n.types.contains&&n.types.contains("Files"))}function f(e){if(e!==undefined){r=e}return r}function l(){s.attach(n,"dragover",function(e){if(!a(e)){return}var t=qq.ie()?null:e.dataTransfer.effectAllowed;if(t==="move"||t==="linkMove"){e.dataTransfer.dropEffect="move"}else{e.dataTransfer.dropEffect="copy"}e.stopPropagation();e.preventDefault()});s.attach(n,"dragenter",function(e){if(!f()){if(!a(e)){return}t.onEnter(e)}});s.attach(n,"dragleave",function(e){if(!a(e)){return}t.onLeave(e);var n=document.elementFromPoint(e.clientX,e.clientY);if(qq(this).contains(n)){return}t.onLeaveNotDescendants(e)});s.attach(n,"drop",function(e){if(!f()){if(!a(e)){return}e.preventDefault();t.onDrop(e)}})}var t,n,r,i,s=new qq.DisposeSupport;t={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}};qq.extend(t,e);n=t.element;u();l();return{dropDisabled:function(e){return f(e)},dispose:function(){s.dispose()}}};qq.FineUploader=function(e){qq.FineUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:true,disableDefaultDropzone:false},text:{uploadButton:"Upload a file",cancelButton:"Cancel",retryButton:"Retry",deleteButton:"Delete",failUpload:"Upload failed",dragZone:"Drop files here to upload",dropProcessing:"Processing dropped files...",formatProgress:"{percent}% of {total_size}",waitingForResponse:"Processing..."},template:'<div class="qq-uploader">'+(!this._options.dragAndDrop||!this._options.dragAndDrop.disableDefaultDropzone?'<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>':"")+(!this._options.button?'<div class="qq-upload-button"><div>{uploadButtonText}</div></div>':"")+'<span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span>'+(!this._options.listElement?'<ul class="qq-upload-list"></ul>':"")+"</div>",fileTemplate:"<li>"+'<div class="qq-progress-bar"></div>'+'<span class="qq-upload-spinner"></span>'+'<span class="qq-upload-finished"></span>'+'<span class="qq-upload-file"></span>'+'<span class="qq-upload-size"></span>'+'<a class="qq-upload-cancel" href="#">{cancelButtonText}</a>'+'<a class="qq-upload-retry" href="#">{retryButtonText}</a>'+'<a class="qq-upload-delete" href="#">{deleteButtonText}</a>'+'<span class="qq-upload-status-text">{statusText}</span>'+"</li>",classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",dropDisabled:"qq-upload-drop-area-disabled",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",deleteButton:"qq-upload-delete",retry:"qq-upload-retry",statusText:"qq-upload-status-text",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null,dropProcessing:"qq-drop-processing",dropProcessingSpinner:"qq-drop-processing-spinner"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:true},messages:{tooManyFilesError:"You may only drop one file"},retry:{showAutoRetryNote:true,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:false},deleteFile:{forceConfirm:false,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:false},paste:{promptForName:false,namePromptMessage:"Please name this image"},showMessage:function(e){setTimeout(function(){window.alert(e)},0)},showConfirm:function(e,t,n){setTimeout(function(){var r=window.confirm(e);if(r){t()}else if(n){n()}},0)},showPrompt:function(e,t){var n=new qq.Promise,r=window.prompt(e,t);if(r!=null&&qq.trimStr(r).length>0){n.success(r)}else{n.failure("Undefined or invalid user-supplied value.")}return n}},true);qq.extend(this._options,e,true);this._wrapCallbacks();this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone);this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton);this._options.template=this._options.template.replace(/\{dropProcessingText\}/g,this._options.text.dropProcessing);this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{deleteButtonText\}/g,this._options.text.deleteButton);this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,"");this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;if(!this._button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._dnd=this._setupDragAndDrop();if(this._options.paste.targetElement&&this._options.paste.promptForName){this._setupPastePrompt()}};qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype);qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments);this._listElement.innerHTML=""},addExtraDropzone:function(e){this._dnd.setupExtraDropzone(e)},removeExtraDropzone:function(e){return this._dnd.removeExtraDropzone(e)},getItemByFileId:function(e){var t=this._listElement.firstChild;while(t){if(t.qqFileId==e)return t;t=t.nextSibling}},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments);this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");if(!this._options.button){this._button=this._createUploadButton(this._find(this._element,"button"))}this._bindCancelAndRetryEvents();this._dnd.dispose();this._dnd=this._setupDragAndDrop()},_removeFileItem:function(e){var t=this.getItemByFileId(e);qq(t).remove()},_setupDragAndDrop:function(){var e=this,t=this._find(this._element,"dropProcessing"),n,r,i;r=function(e){e.preventDefault()};if(!this._options.dragAndDrop.disableDefaultDropzone){i=this._find(this._options.element,"drop")}n=new qq.DragAndDrop({dropArea:i,extraDropzones:this._options.dragAndDrop.extraDropzones,hideDropzones:this._options.dragAndDrop.hideDropzones,multiple:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{dropProcessing:function(n,i){var s=e._button.getInput();if(n){qq(t).css({display:"block"});qq(s).attach("click",r)}else{qq(t).hide();qq(s).detach("click",r)}if(i){e.addFiles(i)}},error:function(t,n){e._itemError(t,n)},log:function(t,n){e.log(t,n)}}});n.setup();return n},_leaving_document_out:function(e){return(qq.chrome()||qq.safari()&&qq.windows())&&e.clientX==0&&e.clientY==0||qq.firefox()&&!e.relatedTarget},_storeForLater:function(e){qq.FineUploaderBasic.prototype._storeForLater.apply(this,arguments);var t=this.getItemByFileId(e);qq(this._find(t,"spinner")).hide()},_find:function(e,t){var n=qq(e).getByClass(this._options.classes[t])[0];if(!n){throw new Error("element not found "+t)}return n},_onSubmit:function(e,t){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(e,t)},_onProgress:function(e,t,n,r){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var i,s,o,u;i=this.getItemByFileId(e);s=this._find(i,"progressBar");o=Math.round(n/r*100);if(n===r){u=this._find(i,"cancel");qq(u).hide();qq(s).hide();qq(this._find(i,"statusText")).setText(this._options.text.waitingForResponse);this._displayFileSize(e)}else{this._displayFileSize(e,n,r);qq(s).css({display:"block"})}qq(s).css({width:o+"%"})},_onComplete:function(e,t,n,r){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var i=this.getItemByFileId(e);qq(this._find(i,"statusText")).clearText();qq(i).removeClass(this._classes.retrying);qq(this._find(i,"progressBar")).hide();if(!this._options.disableCancelForFormUploads||qq.isXhrUploadSupported()){qq(this._find(i,"cancel")).hide()}qq(this._find(i,"spinner")).hide();if(n.success){if(this._isDeletePossible()){this._showDeleteLink(e)}qq(i).addClass(this._classes.success);if(this._classes.successIcon){this._find(i,"finished").style.display="inline-block";qq(i).addClass(this._classes.successIcon)}}else{qq(i).addClass(this._classes.fail);if(this._classes.failIcon){this._find(i,"finished").style.display="inline-block";qq(i).addClass(this._classes.failIcon)}if(this._options.retry.showButton&&!this._preventRetries[e]){qq(i).addClass(this._classes.retryable)}this._controlFailureTextDisplay(i,n)}},_onUpload:function(e,t){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments);this._showSpinner(e)},_onCancel:function(e,t){qq.FineUploaderBasic.prototype._onCancel.apply(this,arguments);this._removeFileItem(e)},_onBeforeAutoRetry:function(e){var t,n,r,i,s,o;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments);t=this.getItemByFileId(e);n=this._find(t,"progressBar");this._showCancelLink(t);n.style.width=0;qq(n).hide();if(this._options.retry.showAutoRetryNote){r=this._find(t,"statusText");i=this._autoRetries[e]+1;s=this._options.retry.maxAutoAttempts;o=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,i);o=o.replace(/\{maxAuto\}/g,s);qq(r).setText(o);if(i===1){qq(t).addClass(this._classes.retrying)}}},_onBeforeManualRetry:function(e){var t=this.getItemByFileId(e);if(qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)){this._find(t,"progressBar").style.width=0;qq(t).removeClass(this._classes.fail);qq(this._find(t,"statusText")).clearText();this._showSpinner(e);this._showCancelLink(t);return true}else{qq(t).addClass(this._classes.retryable);return false}},_onSubmitDelete:function(e){if(this._isDeletePossible()){if(this._options.callbacks.onSubmitDelete(e)!==false){if(this._options.deleteFile.forceConfirm){this._showDeleteConfirm(e)}else{this._sendDeleteRequest(e)}}}else{this.log("Delete request ignored for file ID "+e+", delete feature is disabled.","warn");return false}},_onDeleteComplete:function(e,t,n){qq.FineUploaderBasic.prototype._onDeleteComplete.apply(this,arguments);var r=this.getItemByFileId(e),i=this._find(r,"spinner"),s=this._find(r,"statusText");qq(i).hide();if(n){qq(s).setText(this._options.deleteFile.deletingFailedText);this._showDeleteLink(e)}else{this._removeFileItem(e)}},_sendDeleteRequest:function(e){var t=this.getItemByFileId(e),n=this._find(t,"deleteButton"),r=this._find(t,"statusText");qq(n).hide();this._showSpinner(e);qq(r).setText(this._options.deleteFile.deletingStatusText);this._deleteHandler.sendDelete(e,this.getUuid(e))},_showDeleteConfirm:function(e){var t=this._handler.getName(e),n=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,t),r=this.getUuid(e),i=this;this._options.showConfirm(n,function(){i._sendDeleteRequest(e)})},_addToList:function(e,t){var n=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.isXhrUploadSupported()){var r=this._find(n,"cancel");qq(r).remove()}n.qqFileId=e;var i=this._find(n,"file");qq(i).setText(this._options.formatFileName(t));qq(this._find(n,"size")).hide();if(!this._options.multiple){this._handler.cancelAll();this._clearList()}this._listElement.appendChild(n);if(this._options.display.fileSizeOnSubmit&&qq.isXhrUploadSupported()){this._displayFileSize(e)}},_clearList:function(){this._listElement.innerHTML="";this.clearStoredFiles()},_displayFileSize:function(e,t,n){var r=this.getItemByFileId(e),i=this.getSize(e),s=this._formatSize(i),o=this._find(r,"size");if(t!==undefined&&n!==undefined){s=this._formatProgress(t,n)}qq(o).css({display:"inline"});qq(o).setText(s)},_bindCancelAndRetryEvents:function(){var e=this,t=this._listElement;this._disposeSupport.attach(t,"click",function(t){t=t||window.event;var n=t.target||t.srcElement;if(qq(n).hasClass(e._classes.cancel)||qq(n).hasClass(e._classes.retry)||qq(n).hasClass(e._classes.deleteButton)){qq.preventDefault(t);var r=n.parentNode;while(r.qqFileId===undefined){r=n=n.parentNode}if(qq(n).hasClass(e._classes.deleteButton)){e.deleteFile(r.qqFileId)}else if(qq(n).hasClass(e._classes.cancel)){e.cancel(r.qqFileId)}else{qq(r).removeClass(e._classes.retryable);e.retry(r.qqFileId)}}})},_formatProgress:function(e,t){function r(e,t){n=n.replace(e,t)}var n=this._options.text.formatProgress;r("{percent}",Math.round(e/t*100));r("{total_size}",this._formatSize(t));return n},_controlFailureTextDisplay:function(e,t){var n,r,i,s,o;n=this._options.failedUploadTextDisplay.mode;r=this._options.failedUploadTextDisplay.maxChars;i=this._options.failedUploadTextDisplay.responseProperty;if(n==="custom"){s=t[i];if(s){if(s.length>r){o=s.substring(0,r)+"..."}}else{s=this._options.text.failUpload;this.log("'"+i+"' is not a valid property on the server response.","warn")}qq(this._find(e,"statusText")).setText(o||s);if(this._options.failedUploadTextDisplay.enableTooltip){this._showTooltip(e,s)}}else if(n==="default"){qq(this._find(e,"statusText")).setText(this._options.text.failUpload)}else if(n!=="none"){this.log("failedUploadTextDisplay.mode value of '"+n+"' is not valid","warn")}},_showTooltip:function(e,t){e.title=t},_showSpinner:function(e){var t=this.getItemByFileId(e),n=this._find(t,"spinner");n.style.display="inline-block"},_showCancelLink:function(e){if(!this._options.disableCancelForFormUploads||qq.isXhrUploadSupported()){var t=this._find(e,"cancel");qq(t).css({display:"inline"})}},_showDeleteLink:function(e){var t=this.getItemByFileId(e),n=this._find(t,"deleteButton");qq(n).css({display:"inline"})},_itemError:function(e,t){var n=qq.FineUploaderBasic.prototype._itemError.apply(this,arguments);this._options.showMessage(n)},_batchError:function(e){qq.FineUploaderBasic.prototype._batchError.apply(this,arguments);this._options.showMessage(e)},_setupPastePrompt:function(){var e=this;this._options.callbacks.onPasteReceived=function(){var t=e._options.paste.namePromptMessage,n=e._options.paste.defaultName;return e._options.showPrompt(t,n)}}});(function(e){"use strict";var t,n,r,i,s,o,u,a,f,l;o=["uploaderType"];r=function(e){if(e){var r=a(e);u(r);if(s("uploaderType")==="basic"){t(new qq.FineUploaderBasic(r))}else{t(new qq.FineUploader(r))}}return n};i=function(e,t){var r=n.data("fineuploader");if(t){if(r===undefined){r={}}r[e]=t;n.data("fineuploader",r)}else{if(r===undefined){return null}return r[e]}};t=function(e){return i("uploader",e)};s=function(e,t){return i(e,t)};u=function(t){var r=t.callbacks={},i=new qq.FineUploaderBasic;e.each(i._options.callbacks,function(t,s){var o,u;o=/^on(\w+)/.exec(t)[1];o=o.substring(0,1).toLowerCase()+o.substring(1);u=n;r[t]=function(){var n=s,r=Array.prototype.slice.call(arguments),a=u.triggerHandler(o,r);if(a===undefined&&e.inArray(t,i.getPromissoryCallbackNames())>=0){return n()}return a}})};a=function(t,r){var i,u;if(r===undefined){if(t.uploaderType!=="basic"){i={element:n[0]}}else{i={}}}else{i=r}e.each(t,function(t,n){if(e.inArray(t,o)>=0){s(t,n)}else if(n instanceof e){i[t]=n[0]}else if(e.isPlainObject(n)){i[t]={};a(n,i[t])}else if(e.isArray(n)){u=[];e.each(n,function(t,n){if(n instanceof e){e.merge(u,n)}else{u.push(n)}});i[t]=u}else{i[t]=n}});if(r===undefined){return i}};f=function(n){return e.type(n)==="string"&&!n.match(/^_/)&&t()[n]!==undefined};l=function(e){var n=[],r=Array.prototype.slice.call(arguments,1);a(r,n);return t()[e].apply(t(),n)};e.fn.fineUploader=function(i){var s=this,o=arguments,u=[];this.each(function(a,c){n=e(c);if(t()&&f(i)){u.push(l.apply(s,o));if(s.length===1){return false}}else if(typeof i==="object"||!i){r.apply(s,o)}else{e.error("Method "+i+" does not exist on jQuery.fineUploader")}});if(u.length===1){return u[0]}else if(u.length>1){return u}return this}})(jQuery)
